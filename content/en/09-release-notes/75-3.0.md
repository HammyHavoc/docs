# 3.0 Release Notes (Draft)

VersionPress 3.0 is a major usability and reliability release. It is also the first release available on GitHub and fully open-sourced.

Released on XX April 2016.


<div class="note">
  <strong>Note: this is an Early Access release</strong>
  <p>Early Access is a period during which VersionPress is reasonably stable but still young, limited in scope and an external backup is recommended at all times. [Learn more](../getting-started/about-eap).</p>
</div>


## New in 3.0

### UI / usability improvements

- **Filtering & searching in the main table** (#586). Site histories can be long and complex so we've introduced a search / filter box similarly to what you can find in your Gmail or GitHub Issues. It supports these operators:
    - **`author`**: for example, `author: Joe`.
    - **`date`**: for example, `date: 2016-03-20` or `date: <=2016-03-20` or `date: 2016-03-10..2016-03-20`. The syntax is quite flexible.
    - **`entity`**, **`action`**, **`vpid`** – searching by action type. For example, `entity: post` finds all changes to posts. `entity: post action: edit` finds all changes that edited a post.
    - Any other "VP tag" can be used. For example, `Post-Title: Hello World` finds changes only to the Hello World post.
    - Wildcards (`*`) are generally supported in many places. 
- **Undo a selection of commits** (#201). Sometimes, it's useful to undo a selection, or a range of commits in on go. There's now a way to do that easily from the UI. [TODO when the ticket is finished] 
- **Changes done via Customizer produce much nicer messages** (#432). Previously, all the changes done via Customizer were captured as a generic *"Customized theme XYZ"*. Now, you will see much more useful messages like *"Updated title ..."*, *"Updated menu ..."* etc.
- **Notification system** (#215). [TODO when the ticket is finished]
- **Visualization in which environment the commit originated** (#609, #459). Imagine you have a production site and a staging site. You can now see which commit came from where. [TODO when the ticket is finished] 
- **Service panel updated** (#732). [TODO when the ticket is finished]


### Core versioning improvements

- **Date modified handled correctly** (#588). This is a great example of a seemingly simple thing that can turn out to be a huge challenge for VersionPress. In the early days, we quickly discovered that Git creates merge conflicts on `post_modified` and `post_modified_gmt` fields for every change of a post so we decided not to store these fields in our data and compute it from the Git history. This seemed to worked great, however, we didn't realize that there might be posts created *before* VersionPress was activated and this method didn't work for them at all. So in 3.0, we needed to start tracking the `post_modified` field *and* avoid a merge conflict at the same time. This lead to implementing our own merge driver that handles this but also gave us the opportunity to handle the following point:
- **Changes on adjacent lines no longer conflict** (#719). By default, Git sees changes on adjacent lines as a conflict so for example if you update a `post_title` and someone else updates a `post_content`, Git sees that as a conflict which is not correct in our situation. Our merge driver prevents these conflicts.
- **Shortcodes with IDs work across environments** (#654). If there's a shortcode like `[gallery ids="2,3,4"]` somewhere, VersionPress will now correctly translated the IDs to universally unique IDs so that they work across environments (and during reverts). We needed to introduce a new `*-shortcodes.yml` file format that describes the shortcodes for VersionPress, similarly to how `*-schema.yml` describe the database. (BTW, we switched from NEON to YAML, see below.)
- **Frequent DB writes** (#512). Imagine a plugin that increases a `postmeta` every time a post is viewed. As VersionPress tracks all the database changes, this would create a lot of commits that don't have much value. On the other hand, the value needs to be stored in the Git repository eventually, otherwise the site info would not be complete. VersionPress 3.0 deals with this by introducing a concept of *frequently written entities* that are ignored most of the time but committed by WP-Cron in predefined intervals (every hour by default) or on actions such as cloning and merging between environments.
- **Configurable entity ignoring** (#511). Some entities you just want to ignore completely, for example, transient options or spam comments. We used to support some of them in v1+v2, e.g., transients, but the support was hardcoded and not easily extendable. In v3, the mechanism got much butter and is in fact technically very similar to frequent DB writes, just with the difference that these entities are never committed to the Git repo, until they are updated so that they no longer match the rule (for example, when a spam comment gets approved, it is no longer ignored and will be committed to the Git repo as any other comment).
- **Initial support for custom directory layouts** (#565). You can now rename or move `wp-content`, `plugins`, and `uploads` directories or the whole WordPress folder to another location(s). The support is initial, for example, the structure needs to be defined before VersionPress is activated, more complex setups like Bedrock are not yet fully supported etc.
- **Data updates via `query()` are now understood** (#510). Most of the data updates are done via `insert()`, `update()` or `delete()` methods which accept PHP arrays and are quite easy to reason about. However, some data goes through the generic `query()` method which accepts a plain string and is *much* harder to understand. However, it cannot really be avoided because in some cases, the `query()` method is the only way to go and also some badly coded plugins use this. In VersionPress 3.0, we added SQL parsing and some magic around it so that it understands raw queries. (We ran our test suite with *just* the `query()` method, removing our implementations of `insert()`, `update()` and `delete()`, and it worked fine. This means that in the future, we will be able to use only the `query()` method hook but in v3, we keep the older and theoretically more reliable three other hooks.)
- **Common (shared) config** (#630). Most things in `wp-config.php` are environment-specific, for example, database connection, so VersionPress gitignored this file since 1.0-beta2. However, some config values should be sometimes shared, e.g., if you have custom folder structure, `WP_CONTENT_DIR` or `WP_PLUGIN_DIR` should be the same in all environments. To support this, VersionPress 3.0 adds a common config file called `wp-config.common.php` which is committed into the repository and `require`'d from the standard `wp-config.php` file. 


### Other notable changes

- `vpconfig.neon` (custom configuration format) replaced by the standard `wp-config.php` constants (#566)
- NEON file format replaced with a similar but more common YAML (#703) 
- PHP 5.6+ is now required – #726
- VersionPress underwent a security review and general code review by [@danielbachhuber](https://twitter.com/danielbachhuber) – thank you Daniel!


### Other changes

[TODO]


## Upgrade notes

VersionPress 3.0 is not auto-upgradable from 2.x or any previous release, full re-activation is required. The recommended procedure is:

 1. Put the site under maintenance mode
 2. Deactivate VersionPress (just deactivate, do not uninstall)
 3. Delete the contents of `wp-content/plugins/versionpress` and extract the current version of VersionPress there
 4. Activate & initialize the plugin again
 5. Disable the maintenance mode


## System requirements

General system requirements:

 - PHP 5.6.0 or later
 - WordPress 4.4 or later
 - Git 1.9 or later
 - `proc_open()` enabled on the server

System requirements for sync / multi-instance workflows:

 - Custom server / VPS is recommended as most hosts will pose further restrictions on creating site clones.
